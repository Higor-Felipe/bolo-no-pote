<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrinho - Doces no Pote</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #d81b60; --secondary: #6d4c41; }
        body { background-color: #fdf6f0; font-family: 'Poppins', sans-serif; }
        .navbar { background: linear-gradient(135deg, var(--primary), var(--secondary)); }
        .navbar-brand, .nav-link { color: white !important; font-weight: 600; }
        .cart-item-img { width: 80px; height: 80px; object-fit: cover; border-radius: 12px; }
        .total-price { font-size: 1.8rem; font-weight: bold; color: var(--primary); }
        .qrcode-placeholder {
            width: 220px;
            height: 220px;
            background: #f8f9fa;
            border: 3px dashed #ccc;
            margin: 25px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            color: #666;
            border-radius: 15px;
        }
        .payment-info {
            background: #e3f2fd;
            border-left: 5px solid var(--primary);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- Cabe√ßalho -->
<nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
        <a class="navbar-brand" href="index.html">
            <i class="fas fa-birthday-cake"></i> Doces no Pote
        </a>
        <a href="index.html" class="btn btn-outline-light ms-auto">
            <i class="fas fa-arrow-left"></i> Voltar √†s compras
        </a>
    </div>
</nav>

<div class="container py-5" id="carrinho-page">
    <h2 class="mb-4 text-center" style="color: var(--secondary);">
        <i class="fas fa-shopping-cart"></i> Seu Carrinho
    </h2>

    <div id="carrinho-vazio" class="text-center py-5 d-none">
        <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
        <p class="text-muted">Seu carrinho est√° vazio.</p>
        <a href="index.html" class="btn btn-primary">Escolher sabores</a>
    </div>

    <div id="carrinho-itens"></div>

    <div id="form-dados" class="mt-5 d-none">
        <h4><i class="fas fa-user"></i> Dados do Cliente</h4>
        <div class="mb-3">
            <label class="form-label">Nome completo *</label>
            <input type="text" id="nome-cliente" class="form-control" required>
        </div>

        <h4 class="mt-4"><i class="fas fa-money-bill-wave"></i> M√©todo de Pagamento</h4>
        <div class="row">
            <div class="col-md-4 mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="pagamento" id="pag-pix" value="pix">
                    <label class="form-check-label fw-bold" for="pag-pix">PIX</label>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="pagamento" id="pag-dinheiro" value="dinheiro">
                    <label class="form-check-label fw-bold" for="pag-dinheiro">Dinheiro</label>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="pagamento" id="pag-cartao" value="cartao">
                    <label class="form-check-label fw-bold" for="pag-cartao">Cart√£o (D√©b/Cr√©d)</label>
                </div>
            </div>
        </div>

        <div id="msg-pagamento"></div>

        <div class="text-center mt-4">
            <h3 class="total-price">Total: R$ <span id="total-valor">0,00</span></h3>
            <button id="btn-concluir" class="btn btn-success btn-lg px-5 mt-3">
                <i class="fab fa-whatsapp"></i> Enviar Pedido no WhatsApp
            </button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const sabores = [ /* Mesmos dados do index.html - copie e cole aqui para consist√™ncia */ ];
    let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];

    // Copie o array `sabores` do index.html aqui (ou use um arquivo externo .js compartilhado)
    const saboresData = [
        { id: 1, nome: "Prest√≠gio", descricao: "Deliciosa combina√ß√£o de brigadeiro com coco ralado e cobertura de chocolate.", preco: 12.90, img: "" },
        { id: 2, nome: "Ninho", descricao: "Cremoso leite ninho com toque suave e aveludado.", preco: 11.90, img: "" },
        { id: 3, nome: "Ninho com Brigadeiro", descricao: "A cl√°ssica dupla: creme de ninho com brigadeiro gourmet.", preco: 13.90, img: "" },
        { id: 4, nome: "Brigadeiro", descricao: "O tradicional brigadeiro cremoso, feito com chocolate belga.", preco: 11.90, img: "" },
        { id: 5, nome: "Dois Amores", descricao: "Brigadeiro tradicional + brigadeiro branco em camadas perfeitas.", preco: 13.90, img: "" }
    ];

    function renderizarCarrinho() {
        const itensDiv = document.getElementById('carrinho-itens');
        const vazio = document.getElementById('carrinho-vazio');
        const form = document.getElementById('form-dados');

        if (carrinho.length === 0) {
            vazio.classList.remove('d-none');
            form.classList.add('d-none');
            return;
        }

        vazio.classList.add('d-none');
        form.classList.remove('d-none');

        itensDiv.innerHTML = '';
        let total = 0;

        carrinho.forEach((item, index) => {
            const sabor = saboresData.find(s => s.id == item.id);
            const subtotal = item.preco * item.quantidade;
            total += subtotal;

            const div = `
                <div class="cart-item d-flex align-items-center">
                    <img src="${item.img || 'https://via.placeholder.com/80'}" class="cart-item-img me-3" alt="${item.nome}">
                    <div class="flex-grow-1">
                        <h6 class="mb-1">${item.nome}</h6>
                        <small class="text-muted">R$ ${item.preco.toFixed(2)} unid.</small>
                    </div>
                    <div class="text-center">
                        <small>Qtd:</small><br>
                        <strong>${item.quantidade}</strong>
                    </div>
                    <div class="text-end ms-4">
                        <strong>R$ ${subtotal.toFixed(2)}</strong>
                    </div>
                    <button class="btn btn-sm btn-danger ms-3" onclick="removerItem(${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            itensDiv.innerHTML += div;
        });

        document.getElementById('total-valor').textContent = total.toFixed(2);

        // Eventos de pagamento
        document.querySelectorAll('input[name="pagamento"]').forEach(radio => {
            radio.addEventListener('change', () => {
                const msgDiv = document.getElementById('msg-pagamento');
                msgDiv.innerHTML = '';
                const metodo = radio.value;

                if (metodo === 'pix') {
                    msgDiv.innerHTML = `
                        <div class="payment-info">
                            <p><strong>PIX selecionado!</strong> Ap√≥s clicar em "Concluir", ser√° exibido o QR Code.</p>
                            <div class="qrcode-placeholder">
                                QR Code aparecer√° aqui ap√≥s concluir
                            </div>
                        </div>
                    `;
                } else if (metodo === 'dinheiro') {
                    msgDiv.innerHTML = `<div class="payment-info">üíµ Pagamento em dinheiro ser√° feito na hora da retirada.</div>`;
                } else if (metodo === 'cartao') {
                    msgDiv.innerHTML = `<div class="payment-info">üí≥ Pagamento com cart√£o (d√©bito ou cr√©dito) ser√° na retirada ou combinado com a loja.</div>`;
                }
            });
        });

        // Bot√£o concluir
        document.getElementById('btn-concluir').onclick = () => {
            const nome = document.getElementById('nome-cliente').value.trim();
            const metodo = document.querySelector('input[name="pagamento"]:checked')?.value;

            if (!nome || !metodo) {
                alert('Preencha seu nome e escolha o m√©todo de pagamento!');
                return;
            }

            let mensagem = `*NOVO PEDIDO - DOCES NO POTE*%0A%0A`;
            mensagem += `üë§ *Cliente:* ${nome}%0A`;
            mensagem += `üí≥ *Pagamento:* ${metodo.toUpperCase()}%0A%0A`;
            mensagem += `*ITENS:*%0A`;

            carrinho.forEach(item => {
                mensagem += `‚Ä¢ ${item.quantidade}x ${item.nome} - R$ ${(item.preco * item.quantidade).toFixed(2)}%0A`;
            });

            mensagem += `%0Aüí∞ *Total: R$ ${total.toFixed(2)}*`;

            if (metodo === 'pix') {
                // Simula QR Code (em produ√ß√£o, gere com API)
                const qrcodeDiv = document.querySelector('.qrcode-placeholder');
                qrcodeDiv.innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=PIX_CHAVE_AQUI" class="img-fluid">`;
                alert('QR Code gerado! Escaneie para pagar.');
            }

            const whatsappUrl = `https://wa.me/5547999999999?text=${mensagem}`; // SUBSTITUA O N√öMERO
            window.open(whatsappUrl, '_blank');
        };
    }

    function removerItem(index) {
        carrinho.splice(index, 1);
        localStorage.setItem('carrinho', JSON.stringify(carrinho));
        renderizarCarrinho();
        // Atualiza contador no index.html (se aberto)
        if (window.opener) window.opener.atualizarContador();
    }

    document.addEventListener('DOMContentLoaded', renderizarCarrinho);
</script>

</body>
</html>